stages:
- stage: StageA
  jobs:
  - job: A1
    steps:

      - task: gitversion/setup@0
        inputs:
          versionSpec: '5.x'

      - task: gitversion/execute@0
        displayName: Determine Version

      - pwsh: echo "##vso[task.setvariable variable=RunStageB;isOutput=true]true"
        name: setvarStep
      - bash: echo $(System.JobName)

  - job: A2
    steps:
      - pwsh: echo "##vso[task.setvariable variable=RunStageC;isOutput=true]true"
        name: setvarStep
      - bash: echo $(System.JobName)

      - task: DotNetCoreCLI@2
        displayName: : Build Inventory.API.sln
        inputs:
          command: 'build'
          projects: 'Services/Inventory.API.sln'

      - task: DotNetCoreCLI@2
        displayName: : Test Inventory.API.sln
        inputs:
          command: 'test'
          projects: 'Services/Inventory.API.sln'
          

- stage: StageB
  dependsOn:
    - StageA

  # when referring to another stage, stage name is included in variable path
  condition: eq(dependencies.StageA.outputs['A1.setvarStep.RunStageB'], 'true')

  # Variables reference syntax differs slightly from inter-stage condition syntax
  variables:
    myOutputVar: $[stageDependencies.StageA.A1.outputs['setvarStep.RunStageB']]
  jobs:
  - deployment: B1
    pool:
      vmImage: 'ubuntu-16.04'
    environment: env1
    strategy:
      runOnce:
        deploy:
          steps:
          - bash: echo $(myOutputVar)